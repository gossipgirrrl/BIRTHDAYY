<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joyeux Anniversaire Maman !</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- NEW COLOR THEME (Rose Gold / Warm Pink) --- */
        :root {
            --primary-color: #e8adaa; /* Rose Gold Pink */
            --secondary-color: #d4af37; /* Gold accent */
            --bg-gradient-start: #3d1e2b; /* Deep warm rose background */
            --bg-gradient-end: #1a0a12; /* Darker warm background */
            --text-color: #fff0f5; /* Soft white text */
            --cake-color: #fcefed; /* Vanilla cake */
            --icing-color: #e8adaa; /* Pink icing */
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-gradient-end);
            /* Updated warm gradient background */
            background-image: radial-gradient(circle at center, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-color);
            overflow: hidden; 
            text-align: center;
        }

        /* --- STARS (Slightly warmer glow) --- */
        .star { position: absolute; background: #fffde7; border-radius: 50%; opacity: 0; animation: twinkle 2s infinite ease-in-out; z-index: 0; box-shadow: 0 0 5px var(--secondary-color); }
        @keyframes twinkle { 0% { opacity: 0; transform: scale(0.5); } 50% { opacity: 0.8; transform: scale(1.2); } 100% { opacity: 0; transform: scale(0.5); } }

        /* --- BALLOONS --- */
        .balloon { position: absolute; bottom: -100px; width: 40px; height: 50px; background: var(--primary-color); border-radius: 50%; opacity: 0.6; z-index: 1; animation: floatUp 10s linear infinite; }
        .balloon::before { content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 2px; height: 40px; background: rgba(255,255,255,0.3); }
        @keyframes floatUp { 0% { bottom: -100px; transform: translateX(0); } 50% { transform: translateX(20px); } 100% { bottom: 110vh; transform: translateX(-20px); } }

        /* --- START SCREEN --- */
        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(26, 10, 18, 0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 999; cursor: pointer; }
        #start-screen h2 { font-family: 'Dancing Script', cursive; font-size: 3.5em; color: var(--primary-color); animation: pulse 1.5s infinite; text-transform: uppercase; text-shadow: 0 0 10px rgba(232, 173, 170, 0.5); }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.1);} 100% {transform: scale(1);} }

        #cake-section { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 1s ease-in-out; z-index: 10; position: relative; }

        /* --- CAKE --- */
        .cake { position: relative; width: 250px; height: 200px; margin-bottom: 50px; margin-top: 50px; }
        .plate { width: 270px; height: 10px; background-color: #ccc; border-radius: 10px; position: absolute; bottom: 0; left: -10px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .layer { position: absolute; background-color: var(--cake-color); width: 100%; border-radius: 5px 5px 0 0; box-shadow: inset -10px 0px 10px rgba(0,0,0,0.1); }
        .layer-bottom { height: 80px; bottom: 10px; width: 250px; }
        .layer-middle { height: 60px; bottom: 90px; width: 200px; left: 25px; }
        .icing { position: absolute; background-color: var(--icing-color); width: 100%; height: 15px; top: 0; border-radius: 5px 5px 0 0; z-index: 1; }
        .drip { position: absolute; background-color: var(--icing-color); width: 15px; height: 30px; border-radius: 0 0 10px 10px; top: 10px; }
        .drip:nth-child(1) { left: 10%; height: 25px; } .drip:nth-child(2) { left: 30%; height: 35px; } .drip:nth-child(3) { left: 50%; height: 20px; } .drip:nth-child(4) { left: 70%; height: 30px; } .drip:nth-child(5) { left: 90%; height: 15px; }
        .candle-container { position: absolute; top: -30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 5; }
        .candle { width: 10px; height: 35px; background: #fff; border: 1px solid #ddd; border-radius: 3px; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .flame { width: 12px; height: 20px; background: radial-gradient(ellipse at bottom, #ffff00 0%, #ffad33 60%, #ff3300 100%); border-radius: 50% 50% 20% 20%; position: absolute; top: -20px; left: -1px; animation: flicker 0.1s infinite alternate; transform-origin: center bottom; }
        @keyframes flicker { 0% { transform: scale(1) rotate(-2deg); opacity: 0.9; } 100% { transform: scale(1) rotate(2deg); opacity: 1; } }
        .flame.out { display: none; }
        
        #instruction-text { font-size: 1.4em; color: var(--primary-color); margin-top: 20px; text-shadow: 0 0 10px rgba(232, 173, 170, 0.5); }

        /* --- LETTER SECTION --- */
        #letter-section {
            display: none;
            height: auto; 
            min-height: 100vh;
            padding: 50px 20px;
            background: rgba(26, 10, 18, 0.8); /* Warmer dark overlay */
            opacity: 0;
            transition: opacity 2s ease-in;
            z-index: 20;
            position: relative;
        }
        .content-container {
            max-width: 600px;
            margin: 0 auto;
            /* Warmer container background */
            background: rgba(61, 30, 43, 0.9);
            padding: 40px;
            border-radius: 20px;
            /* Rose gold border and shadow */
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 30px rgba(232, 173, 170, 0.4);
            backdrop-filter: blur(10px);
            word-wrap: break-word;
        }
        .mom-photo {
            width: 200px;
            height: 200px;
            /* --- IMPORTANT: RENAME MOM'S PHOTO TO maman.jpg --- */
            background-image: url('maman.jpg');
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            border: 4px solid var(--primary-color);
            margin: 0 auto 30px auto;
            box-shadow: 0 0 15px var(--primary-color);
            animation: floatPhoto 4s ease-in-out infinite;
        }
        @keyframes floatPhoto { 0% {transform: translateY(0px);} 50% {transform: translateY(-10px);} 100% {transform: translateY(0px);} }
        h1.birthday-header { font-family: 'Dancing Script', cursive; font-size: 3.5em; color: var(--primary-color); margin-bottom: 10px; text-shadow: 0 0 5px rgba(232, 173, 170, 0.5);}
        .letter-text { font-size: 1.1em; line-height: 1.8; text-align: left; white-space: pre-wrap; min-height: 100px; color: #fff0f5; }
        .cursor { display: inline-block; width: 2px; height: 1em; background-color: var(--primary-color); animation: blink 1s infinite; }
        @keyframes blink { 0% {opacity:1;} 50% {opacity:0;} 100% {opacity:1;} }

    </style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/03/09/audio_c8c9967676.mp3?filename=motivational-cinematic-piano-110867.mp3" type="audio/mpeg">
    </audio>
    <audio id="cheer-sound">
        <source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_12b0c7443c.mp3?filename=crowd-cheering-143103.mp3" type="audio/mpeg">
    </audio>

    <div id="stars-container"></div>
    <div id="balloons-container"></div>

    <div id="start-screen">
        <h2>JOYEUX ANNIVERSAIRE MAMAN</h2>
        <p>Tapez n'importe où pour commencer...</p>
        <p style="font-size:0.8em; opacity: 0.7;">(Autorisez l'accès au micro !)</p>
    </div>

    <div id="cake-section">
        <div class="cake">
            <div class="plate"></div>
            <div class="layer layer-bottom"></div>
            <div class="layer layer-middle">
                <div class="icing">
                    <div class="drip"></div><div class="drip"></div><div class="drip"></div><div class="drip"></div><div class="drip"></div>
                </div>
            </div>
            <div class="candle-container">
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
                <div class="candle"><div class="flame"></div></div>
            </div>
        </div>
        <div id="instruction-text">Soufflez fort dans le micro !</div>
    </div>

    <div id="letter-section">
        <div class="content-container">
            <div class="mom-photo"></div>
            <h1 class="birthday-header">Joyeux Anniversaire !</h1>
            <div class="letter-text" id="typewriter-text"></div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        // Your French letter, using backticks (`) to handle apostrophes correctly.
        const finalLetter = `Ma chère Maman,

En ce jour si spécial qui marque ton anniversaire, j’ai voulu prendre un moment pour t’écrire ces quelques lignes. On ne prend pas toujours le temps, dans le tourbillon du quotidien, de dire les choses essentielles, mais aujourd’hui, je veux que tu saches à quel point tu es précieuse pour nous.

Maman, tu es notre pilier, confidente et la plus grande source d’inspiration. Depuis mon premier cri, tu as été là pour me guider, m’encourager et m’aimer inconditionnellement. Ta force, ta générosité et ta bienveillance m'épatent chaque jour un peu plus. Si nous sommes la personne que on est aujourd’hui, c’est en grande partie grâce à toi et aux valeurs que tu m’as transmises.

Je te remercie pour tous les sacrifices que tu as faits, pour tes conseils toujours avisés et pour la chaleur de tes bras qui reste, malgré les années, l'endroit où je me sens le plus en sécurité.

Pour cette nouvelle année qui commence pour toi, je te souhaite tout le bonheur du monde. Que ta journée soit remplie de rires, de douceur et entourée de tout l'amour que tu mérites tant. J'espère pouvoir te rendre, ne serait-ce qu'une fraction, de tout l'amour que tu me donnes sans compter.

Joyeux anniversaire, Maman. Je t’aime plus que les mots ne peuvent l’exprimer.

Tes enfant qui t'aime.`;

        const startScreen = document.getElementById('start-screen');
        const cakeSection = document.getElementById('cake-section');
        const letterSection = document.getElementById('letter-section');
        const flames = document.querySelectorAll('.flame');
        const instructionText = document.getElementById('instruction-text');
        const typewriterElement = document.getElementById('typewriter-text');
        const bgMusic = document.getElementById('bg-music');
        const cheerSound = document.getElementById('cheer-sound');

        bgMusic.volume = 0.5;
        cheerSound.volume = 0.6;

        let audioContext, analyser, microphone;
        let isListening = false;
        let candlesBlown = false;
        let blowStreak = 0; 

        function createStars() {
            const container = document.getElementById('stars-container');
            for(let i=0; i<50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 2 + 's';
                // Added a slight gold tint to stars
                star.style.backgroundColor = Math.random() > 0.8 ? '#ffd700' : '#fff'; 
                container.appendChild(star);
            }
        }
        createStars();

        function releaseBalloons() {
            const container = document.getElementById('balloons-container');
            // Updated balloon colors to Pink, White, and Gold
            const colors = ['#e8adaa', '#ffffff', '#d4af37'];
            for(let i=0; i<15; i++) {
                const balloon = document.createElement('div');
                balloon.className = 'balloon';
                balloon.style.left = Math.random() * 100 + 'vw';
                balloon.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                balloon.style.animationDuration = (Math.random() * 5 + 5) + 's';
                balloon.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(balloon);
            }
        }

        startScreen.addEventListener('click', async () => {
            try {
                bgMusic.play().catch(e => console.log("Audio prevented:", e));
                
                startScreen.style.opacity = '0';
                setTimeout(() => { 
                    startScreen.style.display = 'none';
                    cakeSection.style.opacity = '1';
                    cakeSection.style.pointerEvents = 'all';
                    
                    // French Alert message if mic fails
                    navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        initializeAudio(stream);
                    })
                    .catch(err => {
                        console.error("Mic denied:", err);
                        alert("J'ai besoin de t'entendre pour souffler les bougies ! Actualise la page et autorise le microphone.");
                    });
                }, 800);
            } catch (err) {
                console.log(err);
            }
        });

        function initializeAudio(stream) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            microphone = audioContext.createMediaStreamSource(stream);
            microphone.connect(analyser);
            analyser.fftSize = 512;
            isListening = true;
            detectBlow();
        }

        function detectBlow() {
            if (!isListening || candlesBlown) return;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);

            let sum = 0;
            let lowFreqCount = Math.floor(bufferLength / 2);
            for(let i = 0; i < lowFreqCount; i++) { sum += dataArray[i]; }
            let average = sum / lowFreqCount;

            if (average > 140) { blowStreak++; } else { blowStreak = 0; }

            if (blowStreak > 5) {
                celebrate();
            } else {
                requestAnimationFrame(detectBlow);
            }
        }

        function celebrate() {
            candlesBlown = true;
            isListening = false;
            
            flames.forEach(f => f.classList.add('out'));
            // French celebration text
            instructionText.innerText = "BRAVO ! Joyeux Anniversaire Maman !";
            
            cheerSound.play().catch(e => console.log(e));
            // Updated Confetti colors (Pink, White, Gold)
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#e8adaa', '#ffffff', '#d4af37'] });

            setTimeout(() => {
                cakeSection.style.opacity = '0';
                setTimeout(() => {
                    cakeSection.style.display = 'none';
                    letterSection.style.display = 'block';
                    document.body.style.overflow = 'auto'; 
                    releaseBalloons();
                    
                    setTimeout(() => {
                        letterSection.style.opacity = '1';
                        typeWriter(); 
                    }, 100);
                }, 1000);
            }, 3000);
        }

        let charIndex = 0;
        function typeWriter() {
            if (charIndex < finalLetter.length) {
                const char = finalLetter.charAt(charIndex);
                if(char === '\n') {
                    typewriterElement.innerHTML += '<br>';
                } else {
                    typewriterElement.innerHTML += char;
                }
                charIndex++;
                setTimeout(typeWriter, 50); 
            } else {
                typewriterElement.innerHTML += "<span class='cursor'></span>";
            }
        }
    </script>
</body>
</html>